{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "workspace": {
            "type": "String"
        }
    },
    "resources": [
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/fca949cc-79ca-446e-8064-01aa7e52ece5')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/fca949cc-79ca-446e-8064-01aa7e52ece5')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2022-11-01-preview",
            "properties": {
                "displayName": "HackTool - PCHunter Execution",
                "description": "Detects suspicious use of PCHunter, a tool like Process Hacker to view and manipulate processes, kernel options and other low level stuff\nSource URL: https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_hktl_pchunter.yml\nAuthor: Florian Roth (Nextron Systems), Nasreddine Bencherchali\nDate Modified: 2023-02-13\nStatus: experimental\nReferences: http://www.xuetr.com/, https://www.crowdstrike.com/blog/falcon-overwatch-report-finds-increase-in-ecrime/, https://www.hexacorn.com/blog/2018/04/20/kernel-hacking-tool-you-might-have-never-heard-of-xuetr-pchunter/\nFalse Positives: Unlikely",
                "severity": "high",
                "enabled": true,
                "query": "_Im_ProcessCreate\n| where ((TargetProcessName endswith \"\\\\PCHunter64.exe\" or TargetProcessName endswith \"\\\\PCHunter32.exe\") or (TargetProcessFilename =~ \"PCHunter.exe\" or TargetProcessFileDescription =~ \"Epoolsoft Windows Information View Tools\") or (Hashes contains \"SHA1=5F1CBC3D99558307BC1250D084FA968521482025\" or Hashes contains \"MD5=987B65CD9B9F4E9A1AFD8F8B48CF64A7\" or Hashes contains \"SHA256=2B214BDDAAB130C274DE6204AF6DBA5AEEC7433DA99AA950022FA306421A6D32\" or Hashes contains \"IMPHASH=444D210CEA1FF8112F256A4997EED7FF\" or Hashes contains \"SHA1=3FB89787CB97D902780DA080545584D97FB1C2EB\" or Hashes contains \"MD5=228DD0C2E6287547E26FFBD973A40F14\" or Hashes contains \"SHA256=55F041BF4E78E9BFA6D4EE68BE40E496CE3A1353E1CA4306598589E19802522C\" or Hashes contains \"IMPHASH=0479F44DF47CFA2EF1CCC4416A538663\") or ((md5 =~ \"228dd0c2e6287547e26ffbd973a40f14\" or md5 =~ \"987b65cd9b9f4e9a1afd8f8b48cf64a7\") or (sha1 =~ \"5f1cbc3d99558307bc1250d084fa968521482025\" or sha1 =~ \"3fb89787cb97d902780da080545584d97fb1c2eb\") or (sha256 =~ \"2b214bddaab130c274de6204af6dba5aeec7433da99aa950022fa306421a6d32\" or sha256 =~ \"55f041bf4e78e9bfa6d4ee68be40e496ce3a1353e1ca4306598589e19802522c\") or (TargetProcessIMPHASH =~ \"444d210cea1ff8112f256a4997eed7ff\" or TargetProcessIMPHASH =~ \"0479f44df47cfa2ef1ccc4416a538663\")))",
                "queryFrequency": "P1D",
                "queryPeriod": "P1D",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "startTimeUtc": null,
                "tactics": ["Discovery", "Execution"],
                "techniques": ["T1082", "T1012", "T1083", "T1007", "T1057"],
                "alertRuleTemplateName": "fca949cc-79ca-446e-8064-01aa7e52ece5",
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5M",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": null,
                        "groupByCustomDetails": null
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Account",
                        "fieldMappings": [
                            {
                                "identifier": "FullName",
                                "columnName": "ActorUsername"
                            }
                        ]
                    },
                    {
                        "entityType": "Host",
                        "fieldMappings": [
                            {
                                "identifier": "FullName",
                                "columnName": "Dvc"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "ProcessId",
                                "columnName": "TargetProcessId"
                            },
                            {
                                "identifier": "CommandLine",
                                "columnName": "TargetProcessCommandLine"
                            },
                            {
                                "identifier": "ElevationToken",
                                "columnName": "TargetProcessTokenElevation"
                            }
                        ]
                    },
                    {
                        "entityType": "FileHash",
                        "fieldMappings": [
                            {
                                "identifier": "Algorithm",
                                "columnName": "HashType"
                            },
                            {
                                "identifier": "Value",
                                "columnName": "Hash"
                            }
                        ]
                    },
                    {
                        "entityType": "File",
                        "fieldMappings": [
                            {
                                "identifier": "Directory",
                                "columnName": "TargetProcessCurrentDirectory"
                            },
                            {
                                "identifier": "Name",
                                "columnName": "TargetProcessName"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "ProcessId",
                                "columnName": "ActingProcessId"
                            },
                            {
                                "identifier": "CommandLine",
                                "columnName": "ActingProcessCommandLine"
                            }
                        ]
                    }
                ],
                "sentinelEntitiesMappings": null,
                "templateVersion": "1.0.0"
            }
        }
    ]
}