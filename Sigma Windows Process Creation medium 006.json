{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "workspace": {
            "type": "String"
        }
    },
    "resources": [
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/5163A000-4c76-45a9-804d-dc3f355f1006')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/5163A000-4c76-45a9-804d-dc3f355f1006')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2022-11-01-preview",
            "properties": {
                "displayName": "Sigma Windows Process Creation medium 006",
                "description": "Sigma Windows Process Creation medium 006",
                "severity": "medium",
                "enabled": false,
                "query": "let q0=_Im_ProcessCreate\n| where ActingProcessName endswith \"\\\\sigverif.exe\"|extend RuleId=\"7d4aaec2-08ed-4430-8b96-28420e030e04\";\nlet q1=_Im_ProcessCreate\n| where ((TargetProcessName endswith \"\\\\squirrel.exe\" or TargetProcessName endswith \"\\\\update.exe\") and (((TargetProcessCommandLine contains \" --download \" or TargetProcessCommandLine contains \" --update \" or TargetProcessCommandLine contains \" --updateRollback=\") and TargetProcessCommandLine contains \"http\") or (TargetProcessCommandLine contains \"--processStart\" or TargetProcessCommandLine contains \"--processStartAndWait\" or TargetProcessCommandLine contains \"--createShortcut\")) and (not(((TargetProcessCommandLine contains \"C:\\\\Users\\\\\" and TargetProcessCommandLine contains \"\\\\AppData\\\\Local\\\\Discord\\\\Update.exe\" and TargetProcessCommandLine contains \" --processStart\" and TargetProcessCommandLine contains \"Discord.exe\") or ((TargetProcessCommandLine contains \"C:\\\\Users\\\\\" and TargetProcessCommandLine contains \"\\\\AppData\\\\Local\\\\GitHubDesktop\\\\Update.exe\" and TargetProcessCommandLine contains \"GitHubDesktop.exe\") and (TargetProcessCommandLine contains \"--createShortcut\" or TargetProcessCommandLine contains \"--processStartAndWait\")) or ((TargetProcessCommandLine contains \"C:\\\\Users\\\\\" and TargetProcessCommandLine contains \"\\\\AppData\\\\Local\\\\Microsoft\\\\Teams\\\\Update.exe\" and TargetProcessCommandLine contains \"Teams.exe\") and (TargetProcessCommandLine contains \"--processStart\" or TargetProcessCommandLine contains \"--createShortcut\")) or ((TargetProcessCommandLine contains \"C:\\\\Users\\\\\" and TargetProcessCommandLine contains \"\\\\AppData\\\\Local\\\\yammerdesktop\\\\Update.exe\" and TargetProcessCommandLine contains \"Yammer.exe\") and (TargetProcessCommandLine contains \"--processStart\" or TargetProcessCommandLine contains \"--createShortcut\"))))))|extend RuleId=\"45239e6a-b035-4aaf-b339-8ad379fcb67e\";\nlet q2=_Im_ProcessCreate\n| where (ActingProcessName =~ \"C:\\\\Windows\\\\System32\\\\OpenSSH\\\\sshd.exe\" or (TargetProcessName endswith \"\\\\ssh.exe\" and (TargetProcessCommandLine contains \"ProxyCommand=\" or (TargetProcessCommandLine contains \"PermitLocalCommand\" and TargetProcessCommandLine contains \"LocalCommand\"))))|extend RuleId=\"7d6d30b8-5b91-4b90-a891-46cccaf29598\";\nlet q3=_Im_ProcessCreate\n| where ((TargetProcessCommandLine contains \"-i\" or TargetProcessCommandLine contains \"/install\" or TargetProcessCommandLine contains \"-a\" or TargetProcessCommandLine contains \"/add-driver\" or TargetProcessCommandLine contains \".inf\") and TargetProcessName endswith \"\\\\pnputil.exe\")|extend RuleId=\"a2ea3ae7-d3d0-40a0-a55c-25a45c87cac1\";\nlet q4=_Im_ProcessCreate\n| where ((TargetProcessName endswith \"\\\\DXCap.exe\" or TargetProcessFilename =~ \"DXCap.exe\") and TargetProcessCommandLine contains \" -c \")|extend RuleId=\"60f16a96-db70-42eb-8f76-16763e333590\";\nlet q5=_Im_ProcessCreate\n| where (TargetProcessName endswith \"\\\\sqldumper.exe\" and (TargetProcessCommandLine contains \"0x0110\" or TargetProcessCommandLine contains \"0x01100:40\"))|extend RuleId=\"23ceaf5c-b6f1-4a32-8559-f2ff734be516\";\nlet q6=_Im_ProcessCreate\n| where ((TargetProcessName endswith \"\\\\SyncAppvPublishingServer.exe\" or TargetProcessFilename =~ \"syncappvpublishingserver.exe\") and TargetProcessCommandLine contains \"\\\"n; \")|extend RuleId=\"fbd7c32d-db2a-4418-b92c-566eb8911133\";\nlet q7=_Im_ProcessCreate\n| where (TargetProcessCommandLine contains \"\\\\SyncAppvPublishingServer.vbs\" and TargetProcessCommandLine contains \";\")|extend RuleId=\"36475a7d-0f6d-4dce-9b01-6aeb473bbaf1\";\nlet q8=_Im_ProcessCreate\n| where (((TargetProcessName endswith \"\\\\tracker.exe\" or TargetProcessFileDescription =~ \"Tracker\") and (TargetProcessCommandLine contains \" /d \" or TargetProcessCommandLine contains \" /c \")) and (not((TargetProcessCommandLine contains \" /ERRORREPORT:PROMPT \" or (ActingProcessName endswith \"\\\\Msbuild\\\\Current\\\\Bin\\\\MSBuild.exe\" or ActingProcessName endswith \"\\\\Msbuild\\\\Current\\\\Bin\\\\amd64\\\\MSBuild.exe\")))))|extend RuleId=\"148431ce-4b70-403d-8525-fcc2993f29ea\";\nlet q9=_Im_ProcessCreate\n| where (TargetProcessName endswith \"ttdinject.exe\" or TargetProcessFilename =~ \"TTDInject.EXE\")|extend RuleId=\"b27077d6-23e6-45d2-81a0-e2b356eea5fd\";\nlet q10=_Im_ProcessCreate\n| where ((TargetProcessCommandLine contains \"type \" and TargetProcessCommandLine contains \" > \\\\\\\\\") or (TargetProcessCommandLine contains \"type \\\\\\\\\" and TargetProcessCommandLine contains \" > \"))|extend RuleId=\"aa0b3a82-eacc-4ec3-9150-b5a9a3e3f82f\";\nlet q11=_Im_ProcessCreate\n| where ((TargetProcessName endswith \"\\\\unregmp2.exe\" or TargetProcessFilename =~ \"unregmp2.exe\") and TargetProcessCommandLine contains \" /HideWMP\")|extend RuleId=\"727454c0-d851-48b0-8b89-385611ab0704\";\nlet q12=_Im_ProcessCreate\n| where (TargetProcessCommandLine contains \"UtilityFunctions.ps1\" or TargetProcessCommandLine contains \"RegSnapin \")|extend RuleId=\"0403d67d-6227-4ea8-8145-4e72db7da120\";\nlet q13=_Im_ProcessCreate\n| where (TargetProcessName endswith \"\\\\VisualUiaVerifyNative.exe\" or TargetProcessFilename =~ \"VisualUiaVerifyNative.exe\")|extend RuleId=\"b30a8bc5-e21b-4ca2-9420-0a94019ac56a\";\nlet q14=_Im_ProcessCreate\n| where ((TargetProcessName endswith \"\\\\VSIISExeLauncher.exe\" or TargetProcessFilename =~ \"VSIISExeLauncher.exe\") and (TargetProcessCommandLine contains \" -p \" or TargetProcessCommandLine contains \" -a \"))|extend RuleId=\"18749301-f1c5-4efc-a4c3-276ff1f5b6f8\";\nlet q15=_Im_ProcessCreate\n| where (TargetProcessName endswith \"\\\\wfc.exe\" or TargetProcessFilename =~ \"wfc.exe\")|extend RuleId=\"49be8799-7b4d-4fda-ad23-cafbefdebbc5\";\nlet q16=_Im_ProcessCreate\n| where (ActingProcessName endswith \"\\\\wlrmdr.exe\" or (((TargetProcessName endswith \"\\\\wlrmdr.exe\" or TargetProcessFilename =~ \"WLRMNDR.EXE\") and (TargetProcessCommandLine contains \"-s \" and TargetProcessCommandLine contains \"-f \" and TargetProcessCommandLine contains \"-t \" and TargetProcessCommandLine contains \"-m \" and TargetProcessCommandLine contains \"-a \" and TargetProcessCommandLine contains \"-u \")) and (not((ActingProcessName =~ \"C:\\\\Windows\\\\System32\\\\winlogon.exe\" or ActingProcessName =~ \"-\")))))|extend RuleId=\"9cfc00b6-bfb7-49ce-9781-ef78503154bb\";\nlet q17=_Im_ProcessCreate\n| where (TargetProcessName endswith \"\\\\Microsoft.Workflow.Compiler.exe\" or TargetProcessFilename =~ \"Microsoft.Workflow.Compiler.exe\")|extend RuleId=\"419dbf2b-8a9b-4bea-bf99-7544b050ec8d\";\nlet q18=_Im_ProcessCreate\n| where (((TargetProcessName endswith \"\\\\cscript.exe\" or TargetProcessName endswith \"\\\\wscript.exe\") or (TargetProcessFilename =~ \"cscript.exe\" or TargetProcessFilename =~ \"wscript.exe\")) and TargetProcessCommandLine contains \".vbs -register \")|extend RuleId=\"28c8f68b-098d-45af-8d43-8089f3e35403\";\nlet q19=_Im_ProcessCreate\n| where ActingProcessName endswith \"\\\\mftrace.exe\"|extend RuleId=\"3d48c9d3-1aa6-418d-98d3-8fd3c01a564e\";\nlet q20=_Im_ProcessCreate\n| where ((TargetProcessName endswith \"\\\\MSBuild.exe\" or TargetProcessFilename =~ \"MSBuild.exe\") and (not((ActingProcessName endswith \"\\\\devenv.exe\" or ActingProcessName endswith \"\\\\cmd.exe\" or ActingProcessName endswith \"\\\\msbuild.exe\" or ActingProcessName endswith \"\\\\python.exe\" or ActingProcessName endswith \"\\\\explorer.exe\" or ActingProcessName endswith \"\\\\nuget.exe\"))))|extend RuleId=\"33be4333-2c6b-44f4-ae28-102cdbde0a31\";\nlet q21=_Im_ProcessCreate\n| where ((TargetProcessName endswith \"\\\\msdt.exe\" or TargetProcessFilename =~ \"msdt.exe\") and (TargetProcessCommandLine contains \" /cab \" or TargetProcessCommandLine contains \" -cab \"))|extend RuleId=\"dc4576d4-7467-424f-9eee-fd2b02855fe0\";\nlet q22=_Im_ProcessCreate\n| where (TargetProcessCommandLine contains \"Wscript.\" and TargetProcessCommandLine contains \".Shell\" and TargetProcessCommandLine contains \".Run\")|extend RuleId=\"2c28c248-7f50-417a-9186-a85b223010ee\";\nlet q23=_Im_ProcessCreate\n| where ((TargetProcessName endswith \"\\\\msiexec.exe\" or TargetProcessFilename =~ \"\\\\msiexec.exe\") and (TargetProcessCommandLine contains \" /z \" or TargetProcessCommandLine contains \" -z \") and TargetProcessCommandLine contains \".dll\")|extend RuleId=\"84f52741-8834-4a8c-a413-2eb2269aa6c8\";\nlet q24=_Im_ProcessCreate\n| where (((TargetProcessName endswith \"\\\\powershell.exe\" or TargetProcessName endswith \"\\\\pwsh.exe\" or TargetProcessName endswith \"\\\\cmd.exe\") and (ActingProcessCommandLine contains \"MsiExec.exe\" and ActingProcessCommandLine contains \"-Embedding \")) and (not(((TargetProcessName endswith \":\\\\Windows\\\\System32\\\\cmd.exe\" and TargetProcessCommandLine contains \"C:\\\\Program Files\\\\SplunkUniversalForwarder\\\\bin\\\\\") or (TargetProcessCommandLine contains \"\\\\DismFoDInstall.cmd\" or (ActingProcessCommandLine contains \"\\\\MsiExec.exe -Embedding \" and ActingProcessCommandLine contains \"Global\\\\MSI0000\"))))))|extend RuleId=\"4a2a2c3e-209f-4d01-b513-4155a540b469\";\nlet q25=_Im_ProcessCreate\n| where ((TargetProcessName endswith \"\\\\msiexec.exe\" and (TargetProcessCommandLine contains \" /y\" or TargetProcessCommandLine contains \" -y\")) and (not((TargetProcessCommandLine contains \"\\\\MsiExec.exe\\\" /Y \\\"C:\\\\Program Files\\\\Bonjour\\\\mdnsNSP.dll\" or TargetProcessCommandLine contains \"\\\\MsiExec.exe\\\" /Y \\\"C:\\\\Program Files (x86)\\\\Bonjour\\\\mdnsNSP.dll\" or TargetProcessCommandLine contains \"\\\\MsiExec.exe\\\" /Y \\\"C:\\\\Program Files (x86)\\\\Apple Software Update\\\\ScriptingObjectModel.dll\" or TargetProcessCommandLine contains \"\\\\MsiExec.exe\\\" /Y \\\"C:\\\\Program Files (x86)\\\\Apple Software Update\\\\SoftwareUpdateAdmin.dll\" or TargetProcessCommandLine contains \"\\\\MsiExec.exe\\\" /Y \\\"C:\\\\Windows\\\\CCM\\\\\" or TargetProcessCommandLine contains \"\\\\MsiExec.exe\\\" /Y C:\\\\Windows\\\\CCM\\\\\" or TargetProcessCommandLine contains \"\\\\MsiExec.exe\\\" -Y \\\"C:\\\\Program Files\\\\Bonjour\\\\mdnsNSP.dll\" or TargetProcessCommandLine contains \"\\\\MsiExec.exe\\\" -Y \\\"C:\\\\Program Files (x86)\\\\Bonjour\\\\mdnsNSP.dll\" or TargetProcessCommandLine contains \"\\\\MsiExec.exe\\\" -Y \\\"C:\\\\Program Files (x86)\\\\Apple Software Update\\\\ScriptingObjectModel.dll\" or TargetProcessCommandLine contains \"\\\\MsiExec.exe\\\" -Y \\\"C:\\\\Program Files (x86)\\\\Apple Software Update\\\\SoftwareUpdateAdmin.dll\" or TargetProcessCommandLine contains \"\\\\MsiExec.exe\\\" -Y \\\"C:\\\\Windows\\\\CCM\\\\\" or TargetProcessCommandLine contains \"\\\\MsiExec.exe\\\" -Y C:\\\\Windows\\\\CCM\\\\\"))))|extend RuleId=\"6f4191bb-912b-48a8-9ce7-682769541e6d\";\nunion q0, q1, q2, q3, q4, q5, q6, q7, q8, q9, q10, q11, q12, q13, q14, q15, q16, q17, q18, q19, q20, q21, q22, q23, q24, q25;",
                "queryFrequency": "P1D",
                "queryPeriod": "P1D",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "startTimeUtc": null,
                "tactics": ["DefenseEvasion", "PrivilegeEscalation", "CredentialAccess", "Persistence", "Execution", "CommandAndControl"],
                "techniques": ["T1218", "T1127", "T1216", "T1003", "T1105", "T1059", "T1547", "T1055", "T1202"],
                "alertRuleTemplateName": "5163A000-4c76-45a9-804d-dc3f355f1006",
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5M",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": null,
                        "groupByCustomDetails": null
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Account",
                        "fieldMappings": [
                            {
                                "identifier": "FullName",
                                "columnName": "ActorUsername"
                            }
                        ]
                    },
                    {
                        "entityType": "Host",
                        "fieldMappings": [
                            {
                                "identifier": "FullName",
                                "columnName": "Dvc"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "ProcessId",
                                "columnName": "TargetProcessId"
                            },
                            {
                                "identifier": "CommandLine",
                                "columnName": "TargetProcessCommandLine"
                            },
                            {
                                "identifier": "ElevationToken",
                                "columnName": "TargetProcessTokenElevation"
                            }
                        ]
                    },
                    {
                        "entityType": "FileHash",
                        "fieldMappings": [
                            {
                                "identifier": "Algorithm",
                                "columnName": "HashType"
                            },
                            {
                                "identifier": "Value",
                                "columnName": "Hash"
                            }
                        ]
                    },
                    {
                        "entityType": "File",
                        "fieldMappings": [
                            {
                                "identifier": "Directory",
                                "columnName": "TargetProcessCurrentDirectory"
                            },
                            {
                                "identifier": "Name",
                                "columnName": "TargetProcessName"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "ProcessId",
                                "columnName": "ActingProcessId"
                            },
                            {
                                "identifier": "CommandLine",
                                "columnName": "ActingProcessCommandLine"
                            }
                        ]
                    }
                ],
                "sentinelEntitiesMappings": null,
                "templateVersion": "1.0.0"
            }
        }
    ]
}