{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "workspace": {
            "type": "String"
        }
    },
    "resources": [
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/c86133ad-4725-4bd0-8170-210788e0a7ba')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/c86133ad-4725-4bd0-8170-210788e0a7ba')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2022-11-01-preview",
            "properties": {
                "displayName": "Net WebClient Casing Anomalies",
                "description": "Detects PowerShell command line contents that include a suspicious abnormal casing in the Net.Webclient (e.g. nEt.WEbCliEnT) string as used in obfuscation techniques\nSource URL: https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_powershell_webclient_casing.yml\nAuthor: Florian Roth (Nextron Systems)\nDate Modified: 2023-01-05\nStatus: experimental\nReferences: https://app.any.run/tasks/b9040c63-c140-479b-ad59-f1bb56ce7a97/\nFalse Positives: Unknown",
                "severity": "high",
                "enabled": true,
                "query": "_Im_ProcessCreate\n| where (((TargetProcessName endswith \"\\\\powershell.exe\" or TargetProcessName endswith \"\\\\pwsh.exe\") or (TargetProcessFilename =~ \"PowerShell.EXE\" or TargetProcessFilename =~ \"pwsh.dll\")) and (TargetProcessCommandLine contains \"TgBlAFQALgB3AEUAQg\" or TargetProcessCommandLine contains \"4AZQBUAC4AdwBFAEIA\" or TargetProcessCommandLine contains \"OAGUAVAAuAHcARQBCA\" or TargetProcessCommandLine contains \"bgBFAHQALgB3AGUAYg\" or TargetProcessCommandLine contains \"4ARQB0AC4AdwBlAGIA\" or TargetProcessCommandLine contains \"uAEUAdAAuAHcAZQBiA\" or TargetProcessCommandLine contains \"TgBFAHQALgB3AGUAYg\" or TargetProcessCommandLine contains \"OAEUAdAAuAHcAZQBiA\" or TargetProcessCommandLine contains \"bgBlAFQALgB3AGUAYg\" or TargetProcessCommandLine contains \"4AZQBUAC4AdwBlAGIA\" or TargetProcessCommandLine contains \"uAGUAVAAuAHcAZQBiA\" or TargetProcessCommandLine contains \"TgBlAFQALgB3AGUAYg\" or TargetProcessCommandLine contains \"OAGUAVAAuAHcAZQBiA\" or TargetProcessCommandLine contains \"bgBFAFQALgB3AGUAYg\" or TargetProcessCommandLine contains \"4ARQBUAC4AdwBlAGIA\" or TargetProcessCommandLine contains \"uAEUAVAAuAHcAZQBiA\" or TargetProcessCommandLine contains \"bgBlAHQALgBXAGUAYg\" or TargetProcessCommandLine contains \"4AZQB0AC4AVwBlAGIA\" or TargetProcessCommandLine contains \"uAGUAdAAuAFcAZQBiA\" or TargetProcessCommandLine contains \"bgBFAHQALgBXAGUAYg\" or TargetProcessCommandLine contains \"4ARQB0AC4AVwBlAGIA\" or TargetProcessCommandLine contains \"uAEUAdAAuAFcAZQBiA\" or TargetProcessCommandLine contains \"TgBFAHQALgBXAGUAYg\" or TargetProcessCommandLine contains \"OAEUAdAAuAFcAZQBiA\" or TargetProcessCommandLine contains \"bgBlAFQALgBXAGUAYg\" or TargetProcessCommandLine contains \"4AZQBUAC4AVwBlAGIA\" or TargetProcessCommandLine contains \"uAGUAVAAuAFcAZQBiA\" or TargetProcessCommandLine contains \"TgBlAFQALgBXAGUAYg\" or TargetProcessCommandLine contains \"OAGUAVAAuAFcAZQBiA\" or TargetProcessCommandLine contains \"bgBFAFQALgBXAGUAYg\" or TargetProcessCommandLine contains \"4ARQBUAC4AVwBlAGIA\" or TargetProcessCommandLine contains \"uAEUAVAAuAFcAZQBiA\" or TargetProcessCommandLine contains \"bgBlAHQALgB3AEUAYg\" or TargetProcessCommandLine contains \"4AZQB0AC4AdwBFAGIA\" or TargetProcessCommandLine contains \"uAGUAdAAuAHcARQBiA\" or TargetProcessCommandLine contains \"TgBlAHQALgB3AEUAYg\" or TargetProcessCommandLine contains \"OAGUAdAAuAHcARQBiA\" or TargetProcessCommandLine contains \"bgBFAHQALgB3AEUAYg\" or TargetProcessCommandLine contains \"4ARQB0AC4AdwBFAGIA\" or TargetProcessCommandLine contains \"uAEUAdAAuAHcARQBiA\" or TargetProcessCommandLine contains \"TgBFAHQALgB3AEUAYg\" or TargetProcessCommandLine contains \"OAEUAdAAuAHcARQBiA\" or TargetProcessCommandLine contains \"bgBlAFQALgB3AEUAYg\" or TargetProcessCommandLine contains \"4AZQBUAC4AdwBFAGIA\" or TargetProcessCommandLine contains \"uAGUAVAAuAHcARQBiA\" or TargetProcessCommandLine contains \"TgBlAFQALgB3AEUAYg\" or TargetProcessCommandLine contains \"OAGUAVAAuAHcARQBiA\" or TargetProcessCommandLine contains \"bgBFAFQALgB3AEUAYg\" or TargetProcessCommandLine contains \"4ARQBUAC4AdwBFAGIA\" or TargetProcessCommandLine contains \"uAEUAVAAuAHcARQBiA\" or TargetProcessCommandLine contains \"TgBFAFQALgB3AEUAYg\" or TargetProcessCommandLine contains \"OAEUAVAAuAHcARQBiA\" or TargetProcessCommandLine contains \"bgBlAHQALgBXAEUAYg\" or TargetProcessCommandLine contains \"4AZQB0AC4AVwBFAGIA\" or TargetProcessCommandLine contains \"uAGUAdAAuAFcARQBiA\" or TargetProcessCommandLine contains \"TgBlAHQALgBXAEUAYg\" or TargetProcessCommandLine contains \"OAGUAdAAuAFcARQBiA\" or TargetProcessCommandLine contains \"bgBFAHQALgBXAEUAYg\" or TargetProcessCommandLine contains \"4ARQB0AC4AVwBFAGIA\" or TargetProcessCommandLine contains \"uAEUAdAAuAFcARQBiA\" or TargetProcessCommandLine contains \"TgBFAHQALgBXAEUAYg\" or TargetProcessCommandLine contains \"OAEUAdAAuAFcARQBiA\" or TargetProcessCommandLine contains \"bgBlAFQALgBXAEUAYg\" or TargetProcessCommandLine contains \"4AZQBUAC4AVwBFAGIA\" or TargetProcessCommandLine contains \"uAGUAVAAuAFcARQBiA\" or TargetProcessCommandLine contains \"TgBlAFQALgBXAEUAYg\" or TargetProcessCommandLine contains \"OAGUAVAAuAFcARQBiA\" or TargetProcessCommandLine contains \"bgBFAFQALgBXAEUAYg\" or TargetProcessCommandLine contains \"4ARQBUAC4AVwBFAGIA\" or TargetProcessCommandLine contains \"uAEUAVAAuAFcARQBiA\" or TargetProcessCommandLine contains \"TgBFAFQALgBXAEUAYg\" or TargetProcessCommandLine contains \"OAEUAVAAuAFcARQBiA\" or TargetProcessCommandLine contains \"bgBlAHQALgB3AGUAQg\" or TargetProcessCommandLine contains \"4AZQB0AC4AdwBlAEIA\" or TargetProcessCommandLine contains \"uAGUAdAAuAHcAZQBCA\" or TargetProcessCommandLine contains \"TgBlAHQALgB3AGUAQg\" or TargetProcessCommandLine contains \"OAGUAdAAuAHcAZQBCA\" or TargetProcessCommandLine contains \"bgBFAHQALgB3AGUAQg\" or TargetProcessCommandLine contains \"4ARQB0AC4AdwBlAEIA\" or TargetProcessCommandLine contains \"uAEUAdAAuAHcAZQBCA\" or TargetProcessCommandLine contains \"TgBFAHQALgB3AGUAQg\" or TargetProcessCommandLine contains \"OAEUAdAAuAHcAZQBCA\" or TargetProcessCommandLine contains \"bgBlAFQALgB3AGUAQg\" or TargetProcessCommandLine contains \"4AZQBUAC4AdwBlAEIA\" or TargetProcessCommandLine contains \"uAGUAVAAuAHcAZQBCA\" or TargetProcessCommandLine contains \"TgBlAFQALgB3AGUAQg\" or TargetProcessCommandLine contains \"OAGUAVAAuAHcAZQBCA\" or TargetProcessCommandLine contains \"bgBFAFQALgB3AGUAQg\" or TargetProcessCommandLine contains \"4ARQBUAC4AdwBlAEIA\" or TargetProcessCommandLine contains \"uAEUAVAAuAHcAZQBCA\" or TargetProcessCommandLine contains \"TgBFAFQALgB3AGUAQg\" or TargetProcessCommandLine contains \"OAEUAVAAuAHcAZQBCA\" or TargetProcessCommandLine contains \"bgBlAHQALgBXAGUAQg\" or TargetProcessCommandLine contains \"4AZQB0AC4AVwBlAEIA\" or TargetProcessCommandLine contains \"uAGUAdAAuAFcAZQBCA\" or TargetProcessCommandLine contains \"TgBlAHQALgBXAGUAQg\" or TargetProcessCommandLine contains \"OAGUAdAAuAFcAZQBCA\" or TargetProcessCommandLine contains \"bgBFAHQALgBXAGUAQg\" or TargetProcessCommandLine contains \"4ARQB0AC4AVwBlAEIA\" or TargetProcessCommandLine contains \"uAEUAdAAuAFcAZQBCA\" or TargetProcessCommandLine contains \"TgBFAHQALgBXAGUAQg\" or TargetProcessCommandLine contains \"OAEUAdAAuAFcAZQBCA\" or TargetProcessCommandLine contains \"bgBlAFQALgBXAGUAQg\" or TargetProcessCommandLine contains \"4AZQBUAC4AVwBlAEIA\" or TargetProcessCommandLine contains \"uAGUAVAAuAFcAZQBCA\" or TargetProcessCommandLine contains \"TgBlAFQALgBXAGUAQg\" or TargetProcessCommandLine contains \"OAGUAVAAuAFcAZQBCA\" or TargetProcessCommandLine contains \"bgBFAFQALgBXAGUAQg\" or TargetProcessCommandLine contains \"4ARQBUAC4AVwBlAEIA\" or TargetProcessCommandLine contains \"uAEUAVAAuAFcAZQBCA\" or TargetProcessCommandLine contains \"TgBFAFQALgBXAGUAQg\" or TargetProcessCommandLine contains \"OAEUAVAAuAFcAZQBCA\" or TargetProcessCommandLine contains \"bgBlAHQALgB3AEUAQg\" or TargetProcessCommandLine contains \"4AZQB0AC4AdwBFAEIA\" or TargetProcessCommandLine contains \"uAGUAdAAuAHcARQBCA\" or TargetProcessCommandLine contains \"TgBlAHQALgB3AEUAQg\" or TargetProcessCommandLine contains \"OAGUAdAAuAHcARQBCA\" or TargetProcessCommandLine contains \"bgBFAHQALgB3AEUAQg\" or TargetProcessCommandLine contains \"4ARQB0AC4AdwBFAEIA\" or TargetProcessCommandLine contains \"uAEUAdAAuAHcARQBCA\" or TargetProcessCommandLine contains \"TgBFAHQALgB3AEUAQg\" or TargetProcessCommandLine contains \"OAEUAdAAuAHcARQBCA\" or TargetProcessCommandLine contains \"bgBlAFQALgB3AEUAQg\" or TargetProcessCommandLine contains \"uAGUAVAAuAHcARQBCA\" or TargetProcessCommandLine contains \"bgBFAFQALgB3AEUAQg\" or TargetProcessCommandLine contains \"4ARQBUAC4AdwBFAEIA\" or TargetProcessCommandLine contains \"uAEUAVAAuAHcARQBCA\" or TargetProcessCommandLine contains \"TgBFAFQALgB3AEUAQg\" or TargetProcessCommandLine contains \"OAEUAVAAuAHcARQBCA\" or TargetProcessCommandLine contains \"TgBlAHQALgBXAEUAQg\" or TargetProcessCommandLine contains \"4AZQB0AC4AVwBFAEIA\" or TargetProcessCommandLine contains \"OAGUAdAAuAFcARQBCA\" or TargetProcessCommandLine contains \"bgBFAHQALgBXAEUAQg\" or TargetProcessCommandLine contains \"4ARQB0AC4AVwBFAEIA\" or TargetProcessCommandLine contains \"uAEUAdAAuAFcARQBCA\" or TargetProcessCommandLine contains \"TgBFAHQALgBXAEUAQg\" or TargetProcessCommandLine contains \"OAEUAdAAuAFcARQBCA\" or TargetProcessCommandLine contains \"bgBlAFQALgBXAEUAQg\" or TargetProcessCommandLine contains \"4AZQBUAC4AVwBFAEIA\" or TargetProcessCommandLine contains \"uAGUAVAAuAFcARQBCA\" or TargetProcessCommandLine contains \"TgBlAFQALgBXAEUAQg\" or TargetProcessCommandLine contains \"OAGUAVAAuAFcARQBCA\" or TargetProcessCommandLine contains \"bgBFAFQALgBXAEUAQg\" or TargetProcessCommandLine contains \"4ARQBUAC4AVwBFAEIA\" or TargetProcessCommandLine contains \"uAEUAVAAuAFcARQBCA\"))",
                "queryFrequency": "P1D",
                "queryPeriod": "P1D",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "startTimeUtc": null,
                "tactics": ["Execution"],
                "techniques": ["T1059"],
                "alertRuleTemplateName": "c86133ad-4725-4bd0-8170-210788e0a7ba",
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5M",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": null,
                        "groupByCustomDetails": null
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Account",
                        "fieldMappings": [
                            {
                                "identifier": "FullName",
                                "columnName": "ActorUsername"
                            }
                        ]
                    },
                    {
                        "entityType": "Host",
                        "fieldMappings": [
                            {
                                "identifier": "FullName",
                                "columnName": "Dvc"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "ProcessId",
                                "columnName": "TargetProcessId"
                            },
                            {
                                "identifier": "CommandLine",
                                "columnName": "TargetProcessCommandLine"
                            },
                            {
                                "identifier": "ElevationToken",
                                "columnName": "TargetProcessTokenElevation"
                            }
                        ]
                    },
                    {
                        "entityType": "FileHash",
                        "fieldMappings": [
                            {
                                "identifier": "Algorithm",
                                "columnName": "HashType"
                            },
                            {
                                "identifier": "Value",
                                "columnName": "Hash"
                            }
                        ]
                    },
                    {
                        "entityType": "File",
                        "fieldMappings": [
                            {
                                "identifier": "Directory",
                                "columnName": "TargetProcessCurrentDirectory"
                            },
                            {
                                "identifier": "Name",
                                "columnName": "TargetProcessName"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "ProcessId",
                                "columnName": "ActingProcessId"
                            },
                            {
                                "identifier": "CommandLine",
                                "columnName": "ActingProcessCommandLine"
                            }
                        ]
                    }
                ],
                "sentinelEntitiesMappings": null,
                "templateVersion": "1.0.0"
            }
        }
    ]
}