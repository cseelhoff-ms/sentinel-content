{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "workspace": {
            "type": "String"
        }
    },
    "resources": [
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/5163A000-5160-5160-5160-5163A0000226')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/5163A000-5160-5160-5160-5163A0000226')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2022-11-01-preview",
            "properties": {
                "displayName": "Sigma Windows Process Creation high 26",
                "description": "Sigma Windows Process Creation medium 26",
                "severity": "medium",
                "enabled": false,
                "query": "let q0=_Im_ProcessCreate\n| where ((ActingProcessName endswith \"\\\\spoolsvexe\" and TargetProcessIntegrityLevel =~ \"System\") and ((TargetProcessName endswith \"\\\\gpupdateexe\" or TargetProcessName endswith \"\\\\whoamiexe\" or TargetProcessName endswith \"\\\\nltestexe\" or TargetProcessName endswith \"\\\\taskkillexe\" or TargetProcessName endswith \"\\\\wmicexe\" or TargetProcessName endswith \"\\\\taskmgrexe\" or TargetProcessName endswith \"\\\\scexe\" or TargetProcessName endswith \"\\\\findstrexe\" or TargetProcessName endswith \"\\\\curlexe\" or TargetProcessName endswith \"\\\\wgetexe\" or TargetProcessName endswith \"\\\\certutilexe\" or TargetProcessName endswith \"\\\\bitsadminexe\" or TargetProcessName endswith \"\\\\accesschkexe\" or TargetProcessName endswith \"\\\\wevtutilexe\" or TargetProcessName endswith \"\\\\bcdeditexe\" or TargetProcessName endswith \"\\\\fsutilexe\" or TargetProcessName endswith \"\\\\cipherexe\" or TargetProcessName endswith \"\\\\schtasksexe\" or TargetProcessName endswith \"\\\\writeexe\" or TargetProcessName endswith \"\\\\wuaucltexe\" or TargetProcessName endswith \"\\\\systeminfoexe\" or TargetProcessName endswith \"\\\\regexe\" or TargetProcessName endswith \"\\\\queryexe\") or ((TargetProcessName endswith \"\\\\netexe\" or TargetProcessName endswith \"\\\\net1exe\") and (not(TargetProcessCommandLine contains \"start\"))) or (TargetProcessName endswith \"\\\\cmdexe\" and (not((TargetProcessCommandLine contains \"spl\" or TargetProcessCommandLine contains \"route add\" or TargetProcessCommandLine contains \"program files\")))) or (TargetProcessName endswith \"\\\\netshexe\" and (not((TargetProcessCommandLine contains \"add portopening\" or TargetProcessCommandLine contains \"rule name\")))) or ((TargetProcessName endswith \"\\\\powershellexe\" or TargetProcessName endswith \"\\\\pwshexe\") and (not(TargetProcessCommandLine contains \"spl\"))) or ((TargetProcessName endswith \"\\\\rundll32exe\" or TargetProcessFilename =~ \"RUNDLL32EXE\") and TargetProcessCommandLine endswith \"rundll32exe\")))|extend RuleId=\"5163A000-5160-5160-5160-5163A0000225\"|extend SourceURL=\"https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_spoolsv_susp_child_processes.yml\";\nlet q1=_Im_ProcessCreate\n| where (TargetProcessName endswith \"\\\\sqlcmdexe\" and (TargetProcessCommandLine contains \"SELECT\" and TargetProcessCommandLine contains \"TOP\" and TargetProcessCommandLine contains \"[VeeamBackup][dbo][Credentials]\"))|extend RuleId=\"b57ba453-b384-4ab9-9f40-1038086b4e53\"|extend SourceURL=\"https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_sqlcmd_veeam_dump.yml\";\nlet q2=_Im_ProcessCreate\n| where ((TargetProcessFileProduct =~ \"SQLite\" or (TargetProcessName endswith \"\\\\sqliteexe\" or TargetProcessName endswith \"\\\\sqlite3exe\")) and (TargetProcessCommandLine contains \"\\\\User Data\\\\\" or TargetProcessCommandLine contains \"\\\\Opera Software\\\\\" or TargetProcessCommandLine contains \"\\\\ChromiumViewer\\\\\") and (TargetProcessCommandLine contains \"Login Data\" or TargetProcessCommandLine contains \"Cookies\" or TargetProcessCommandLine contains \"Web Data\" or TargetProcessCommandLine contains \"History\" or TargetProcessCommandLine contains \"Bookmarks\"))|extend RuleId=\"24c77512-782b-448a-8950-eddb0785fc71\"|extend SourceURL=\"https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_sqlite_chromium_profile_data.yml\";\nlet q3=_Im_ProcessCreate\n| where ((TargetProcessFileProduct =~ \"SQLite\" or (TargetProcessName endswith \"\\\\sqliteexe\" or TargetProcessName endswith \"\\\\sqlite3exe\")) and (TargetProcessCommandLine contains \"cookiessqlite\" or TargetProcessCommandLine contains \"placessqlite\"))|extend RuleId=\"4833155a-4053-4c9c-a997-777fcea0baa7\"|extend SourceURL=\"https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_sqlite_firefox_gecko_profile_data.yml\";\nlet q4=_Im_ProcessCreate\n| where (TargetProcessName endswith \"\\\\sshexe\" and TargetProcessCommandLine contains \" -R \")|extend RuleId=\"327f48c1-a6db-4eb8-875a-f6981f1b0183\"|extend SourceURL=\"https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_ssh_port_forward.yml\";\nlet q5=_Im_ProcessCreate\n| where (TargetProcessName endswith \"\\\\sshexe\" and TargetProcessCommandLine contains \":3389\")|extend RuleId=\"f7d7ebd5-a016-46e2-9c54-f9932f2d386d\"|extend SourceURL=\"https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_ssh_rdp_tunneling.yml\";\nlet q6=_Im_ProcessCreate\n| where ((ActingProcessName endswith \"\\\\stordiagexe\" and (TargetProcessName endswith \"\\\\schtasksexe\" or TargetProcessName endswith \"\\\\systeminfoexe\" or TargetProcessName endswith \"\\\\fltmcexe\")) and (not((ActingProcessName startswith \"c:\\\\windows\\\\system32\\\\\" or ActingProcessName startswith \"c:\\\\windows\\\\syswow64\\\\\"))))|extend RuleId=\"961e0abb-1b1e-4c84-a453-aafe56ad0d34\"|extend SourceURL=\"https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_stordiag_susp_child_process.yml\";\nlet q7=_Im_ProcessCreate\n| where ((((ActingProcessName endswith \"\\\\winlogonexe\" or ActingProcessName endswith \"\\\\servicesexe\" or ActingProcessName endswith \"\\\\lsassexe\" or ActingProcessName endswith \"\\\\csrssexe\" or ActingProcessName endswith \"\\\\smssexe\" or ActingProcessName endswith \"\\\\wininitexe\" or ActingProcessName endswith \"\\\\spoolsvexe\" or ActingProcessName endswith \"\\\\searchindexerexe\") and (TargetUsername contains \"AUTHORI\" or TargetUsername contains \"AUTORI\")) and ((TargetProcessName endswith \"\\\\powershellexe\" or TargetProcessName endswith \"\\\\pwshexe\" or TargetProcessName endswith \"\\\\cmdexe\") or (TargetProcessFilename =~ \"PowerShellEXE\" or TargetProcessFilename =~ \"pwshdll\" or TargetProcessFilename =~ \"CmdExe\"))) and (not((TargetProcessCommandLine contains \" route \" and TargetProcessCommandLine contains \" ADD \"))))|extend RuleId=\"d522eca2-2973-4391-a3e0-ef0374321dae\"|extend SourceURL=\"https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_susp_abusing_debug_privilege.yml\";\nlet q8=_Im_ProcessCreate\n| where (((TargetProcessCommandLine contains \"localgroup \" and TargetProcessCommandLine contains \" /add\") or (TargetProcessCommandLine contains \"Add-LocalGroupMember \" and TargetProcessCommandLine contains \" -Group \")) and (TargetProcessCommandLine contains \"Remote Desktop Users\" or TargetProcessCommandLine contains \"Utilisateurs du Bureau \u00e0 distance\" or TargetProcessCommandLine contains \"Usuarios de escritorio remoto\"))|extend RuleId=\"ffa28e60-bdb1-46e0-9f82-05f7a61cc06e\"|extend SourceURL=\"https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_susp_add_user_remote_desktop_group.yml\";\nlet q9=_Im_ProcessCreate\n| where ((ActingProcessName endswith \"\\\\Winrarexe\" or ActingProcessName endswith \"\\\\7zFMexe\" or ActingProcessName endswith \"\\\\peazipexe\") and (TargetProcessName endswith \"\\\\isoburnexe\" or TargetProcessName endswith \"\\\\PowerISOexe\" or TargetProcessName endswith \"\\\\ImgBurnexe\"))|extend RuleId=\"fcdf69e5-a3d3-452a-9724-26f2308bf2b1\"|extend SourceURL=\"https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_susp_archiver_iso_phishing.yml\";\nlet q10=_Im_ProcessCreate\n| where (((TargetProcessName endswith \"\\\\WerFaultexe\" and TargetProcessCommandLine endswith \"WerFaultexe\") or (TargetProcessName endswith \"\\\\rundll32exe\" and TargetProcessCommandLine endswith \"rundll32exe\") or (TargetProcessName endswith \"\\\\regsvcsexe\" and TargetProcessCommandLine endswith \"regsvcsexe\") or (TargetProcessName endswith \"\\\\regasmexe\" and TargetProcessCommandLine endswith \"regasmexe\") or (TargetProcessName endswith \"\\\\regsvr32exe\" and TargetProcessCommandLine endswith \"regsvr32exe\")) and (not((ActingProcessName startswith \"C:\\\\Users\\\\\" and ActingProcessName contains \"\\\\AppData\\\\Local\\\\Microsoft\\\\EdgeUpdate\\\\Install\\\\{\" and ActingProcessName endswith \"\\\\setupexe\" and ActingProcessCommandLine contains \"\\\\setupexe\\\" --install-archive=\\\"C:\\\\Users\\\\\"))))|extend RuleId=\"a7c3d773-caef-227e-a7e7-c2f13c622329\"|extend SourceURL=\"https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_susp_bad_opsec_sacrificial_processes.yml\";\nlet q11=_Im_ProcessCreate\n| where (TargetProcessCommandLine contains \"\\\\calcexe \" or (TargetProcessName endswith \"\\\\calcexe\" and (not((TargetProcessName startswith \"C:\\\\Windows\\\\System32\\\\\" or TargetProcessName startswith \"C:\\\\Windows\\\\SysWOW64\\\\\" or TargetProcessName startswith \"C:\\\\Windows\\\\WinSxS\\\\\")))))|extend RuleId=\"737e618a-a410-49b5-bec3-9e55ff7fbc15\"|extend SourceURL=\"https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_susp_calc.yml\";\nlet q12=_Im_ProcessCreate\n| where (((ParentUser contains \"AUTHORI\" or ParentUser contains \"AUTORI\") and (ParentUser endswith \"\\\\NETWORK SERVICE\" or ParentUser endswith \"\\\\LOCAL SERVICE\") and (TargetUsername contains \"AUTHORI\" or TargetUsername contains \"AUTORI\") and (TargetUsername endswith \"\\\\SYSTEM\" or TargetUsername endswith \"\\\\Syst\u00e8me\" or TargetUsername endswith \"\\\\\u0421\u0418\u0421\u0422\u0415\u041c\u0410\") and TargetProcessIntegrityLevel =~ \"System\") and (not((TargetProcessName endswith \"\\\\rundll32exe\" and TargetProcessCommandLine contains \"DavSetCookie\"))))|extend RuleId=\"590a5f4c-6c8c-4f10-8307-89afe9453a9d\"|extend SourceURL=\"https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_susp_child_process_as_system_.yml\";\nlet q13=_Im_ProcessCreate\n| where ((TargetProcessCommandLine contains \"\u02e3\" or TargetProcessCommandLine contains \"\u02ea\" or TargetProcessCommandLine contains \"\u02e2\") or (TargetProcessCommandLine contains \"\u2215\" or TargetProcessCommandLine contains \"\u2044\") or (TargetProcessCommandLine contains \"\u2015\" or TargetProcessCommandLine contains \"\u2014\") or (TargetProcessCommandLine contains \"\u00e2\" or TargetProcessCommandLine contains \"\u20ac\" or TargetProcessCommandLine contains \"\u00a3\" or TargetProcessCommandLine contains \"\u00af\" or TargetProcessCommandLine contains \"\u00ae\" or TargetProcessCommandLine contains \"\u00b5\" or TargetProcessCommandLine contains \"\u00b6\"))|extend RuleId=\"e0552b19-5a83-4222-b141-b36184bb8d79\"|extend SourceURL=\"https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_susp_cli_obfuscation_unicode.yml\";\nlet q14=_Im_ProcessCreate\n| where (((TargetProcessCommandLine contains \"\\\\\\\\\" and TargetProcessCommandLine contains \"$\") or TargetProcessCommandLine contains \"\\\\Sysvol\\\\\") and (((TargetProcessName endswith \"\\\\robocopyexe\" or TargetProcessName endswith \"\\\\xcopyexe\") or (TargetProcessFilename =~ \"robocopyexe\" or TargetProcessFilename =~ \"XCOPYEXE\")) or ((TargetProcessName endswith \"\\\\cmdexe\" or TargetProcessFilename =~ \"CmdExe\") and TargetProcessCommandLine contains \"copy\") or (((TargetProcessName contains \"\\\\powershellexe\" or TargetProcessName contains \"\\\\pwshexe\") or (TargetProcessFilename =~ \"PowerShellEXE\" or TargetProcessFilename =~ \"pwshdll\")) and (TargetProcessCommandLine contains \"copy-item\" or TargetProcessCommandLine contains \"copy \" or TargetProcessCommandLine contains \"cpi \" or TargetProcessCommandLine contains \" cp \" or TargetProcessCommandLine contains \"move \" or TargetProcessCommandLine contains \"move-item\" or TargetProcessCommandLine contains \" mi \" or TargetProcessCommandLine contains \" mv \"))))|extend RuleId=\"855bc8b5-2ae8-402e-a9ed-b889e6df1900\"|extend SourceURL=\"https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_susp_copy_lateral_movement.yml\";\nlet q15=_Im_ProcessCreate\n| where (((TargetProcessName endswith \"\\\\cmdexe\" and TargetProcessCommandLine contains \"copy \") or ((TargetProcessName endswith \"\\\\powershellexe\" or TargetProcessName endswith \"\\\\pwshexe\") and (TargetProcessCommandLine contains \"copy-item\" or TargetProcessCommandLine contains \" copy \" or TargetProcessCommandLine contains \"cpi \" or TargetProcessCommandLine contains \" cp \")) or ((TargetProcessName endswith \"\\\\robocopyexe\" or TargetProcessName endswith \"\\\\xcopyexe\") or (TargetProcessFilename =~ \"robocopyexe\" or TargetProcessFilename =~ \"XCOPYEXE\"))) and ((TargetProcessCommandLine contains \"\\\\System32\" or TargetProcessCommandLine contains \"\\\\SysWOW64\" or TargetProcessCommandLine contains \"\\\\WinSxS\") and (TargetProcessCommandLine contains \"\\\\bitsadminexe\" or TargetProcessCommandLine contains \"\\\\calcexe\" or TargetProcessCommandLine contains \"\\\\certutilexe\" or TargetProcessCommandLine contains \"\\\\cmdl32exe\" or TargetProcessCommandLine contains \"\\\\cscriptexe\" or TargetProcessCommandLine contains \"\\\\mshtaexe\" or TargetProcessCommandLine contains \"\\\\rundll32exe\" or TargetProcessCommandLine contains \"\\\\wscriptexe\")))|extend RuleId=\"f5d19838-41b5-476c-98d8-ba8af4929ee2\"|extend SourceURL=\"https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_susp_copy_system_dir_lolbin.yml\";\nunion q0, q1, q2, q3, q4, q5, q6, q7, q8, q9, q10, q11, q12, q13, q14, q15;",
                "queryFrequency": "P1D",
                "queryPeriod": "P1D",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "startTimeUtc": null,
                "tactics": ["CommandAndControl", "DefenseEvasion", "Collection", "Persistence", "InitialAccess", "Execution", "Exfiltration", "LateralMovement", "PrivilegeEscalation", "CredentialAccess"],
                "techniques": ["T1555", "T1068", "T1566", "T1218", "T1133", "T1136", "T1539", "T1021", "T1027", "T1005", "T1048", "T1203", "T1036", "T1572", "T1039", "T1134", "T1548"],
                "alertRuleTemplateName": "5163A000-5160-5160-5160-5163A0000226",
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5M",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": null,
                        "groupByCustomDetails": null
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Account",
                        "fieldMappings": [
                            {
                                "identifier": "FullName",
                                "columnName": "ActorUsername"
                            }
                        ]
                    },
                    {
                        "entityType": "Host",
                        "fieldMappings": [
                            {
                                "identifier": "FullName",
                                "columnName": "Dvc"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "ProcessId",
                                "columnName": "TargetProcessId"
                            },
                            {
                                "identifier": "CommandLine",
                                "columnName": "TargetProcessCommandLine"
                            },
                            {
                                "identifier": "ElevationToken",
                                "columnName": "TargetProcessTokenElevation"
                            }
                        ]
                    },
                    {
                        "entityType": "FileHash",
                        "fieldMappings": [
                            {
                                "identifier": "Algorithm",
                                "columnName": "HashType"
                            },
                            {
                                "identifier": "Value",
                                "columnName": "Hash"
                            }
                        ]
                    },
                    {
                        "entityType": "File",
                        "fieldMappings": [
                            {
                                "identifier": "Directory",
                                "columnName": "TargetProcessCurrentDirectory"
                            },
                            {
                                "identifier": "Name",
                                "columnName": "TargetProcessName"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "ProcessId",
                                "columnName": "ActingProcessId"
                            },
                            {
                                "identifier": "CommandLine",
                                "columnName": "ActingProcessCommandLine"
                            }
                        ]
                    }
                ],
                "sentinelEntitiesMappings": null,
                "templateVersion": "1.0.0"
            }
        }
    ]
}